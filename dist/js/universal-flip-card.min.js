class UniversalFlipCard{constructor(element,options={}){this.card=typeof element==="string"?document.querySelector(element):element;if(!this.card){console.error("Universal Flip Card: Element not found");return}this.options=Object.assign({enableHover:true,announceToScreenReader:true,disableAutoFocus:false,customFrontTriggerLabel:null,customBackTriggerLabel:null,enableVoiceControl:false,voiceCommands:{flip:["flip","turn","rotate"],flipBack:["back","return","front"]}},options);this.inner=this.card.querySelector(".universal-card-inner");this.frontSide=this.card.querySelector(".universal-card-front");this.backSide=this.card.querySelector(".universal-card-back");this.frontTrigger=this.frontSide?.querySelector(".flip-trigger");this.backTrigger=this.backSide?.querySelector(".flip-trigger");if(!this.inner||!this.frontSide||!this.backSide){console.error("Universal Flip Card: Invalid card structure");return}this.setupIds();this.detectCapabilities();this.setupAria();this.setupEventListeners();this.setupScreenReaderAnnouncer();if(this.options.enableVoiceControl){this.setupVoiceControl()}this.isFlipped=this.card.classList.contains("flipped");this.card.setAttribute("data-disable-hover",!this.options.enableHover)}setupIds(){if(!this.card.id){this.card.id="universal-card-"+Math.floor(Math.random()*1e4)}this.frontSide.id=this.frontSide.id||`${this.card.id}-front`;this.backSide.id=this.backSide.id||`${this.card.id}-back`;this.frontId=this.frontSide.id;this.backId=this.backSide.id}detectCapabilities(){this.capabilities={touch:"ontouchstart"in window,pointer:window.matchMedia("(pointer: fine)").matches,hover:window.matchMedia("(hover: hover)").matches,reducedMotion:window.matchMedia("(prefers-reduced-motion: reduce)").matches,darkMode:window.matchMedia("(prefers-color-scheme: dark)").matches};if(this.capabilities.touch&&!this.capabilities.pointer){this.inputMethod="touch"}else if(this.capabilities.pointer){this.inputMethod="mouse"}else{this.inputMethod="keyboard"}this.card.setAttribute("data-input-method",this.inputMethod);if(this.capabilities.reducedMotion){document.body.classList.add("reduced-motion")}}setupAria(){if(!this.card.hasAttribute("tabindex")){this.card.setAttribute("tabindex","0")}if(this.frontTrigger){this.frontTrigger.setAttribute("aria-controls",this.backId);this.frontTrigger.setAttribute("aria-expanded",this.isFlipped?"true":"false");this.frontTrigger.setAttribute("aria-pressed",this.isFlipped?"true":"false");if(!this.frontTrigger.hasAttribute("aria-label")&&this.options.customFrontTriggerLabel){this.frontTrigger.setAttribute("aria-label",this.options.customFrontTriggerLabel)}}if(this.backTrigger){this.backTrigger.setAttribute("aria-controls",this.frontId);this.backTrigger.setAttribute("aria-expanded",!this.isFlipped?"true":"false");this.backTrigger.setAttribute("aria-pressed",!this.isFlipped?"true":"false");if(!this.backTrigger.hasAttribute("aria-label")&&this.options.customBackTriggerLabel){this.backTrigger.setAttribute("aria-label",this.options.customBackTriggerLabel)}}this.updateAriaHidden()}updateAriaHidden(){if(this.isFlipped){this.frontSide.setAttribute("aria-hidden","true");this.backSide.setAttribute("aria-hidden","false")}else{this.frontSide.setAttribute("aria-hidden","false");this.backSide.setAttribute("aria-hidden","true")}}setupEventListeners(){if(this.inputMethod==="touch"){this.card.addEventListener("click",this.handleCardClick.bind(this))}if(this.frontTrigger){this.frontTrigger.addEventListener("click",(e=>{e.preventDefault();this.flip(true)}))}if(this.backTrigger){this.backTrigger.addEventListener("click",(e=>{e.preventDefault();this.flip(false)}))}this.card.addEventListener("keydown",this.handleKeydown.bind(this));this.setupPreferenceListeners()}handleCardClick(e){if(!e.target.closest("button, a, input, select, textarea")){this.flip(!this.isFlipped)}}handleKeydown(e){if(e.target.closest("button, a, input, select, textarea")){return}if(e.key==="Enter"||e.key===" "){e.preventDefault();this.flip(!this.isFlipped)}if(e.key==="Escape"&&this.isFlipped){e.preventDefault();this.flip(false)}}setupPreferenceListeners(){window.matchMedia("(prefers-reduced-motion: reduce)").addEventListener("change",(e=>{document.body.classList.toggle("reduced-motion",e.matches)}));window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(e=>{}))}setupScreenReaderAnnouncer(){this.announcer=document.getElementById("sr-announcer");if(!this.announcer){this.announcer=document.createElement("div");this.announcer.id="sr-announcer";this.announcer.className="sr-only";this.announcer.setAttribute("aria-live","polite");this.announcer.setAttribute("aria-atomic","true");document.body.appendChild(this.announcer)}}announceToScreenReader(message){if(!this.options.announceToScreenReader)return;this.announcer.textContent=message}flip(shouldFlip){if(shouldFlip===this.isFlipped)return;this.isFlipped=shouldFlip;this.card.classList.toggle("flipped",shouldFlip);if(this.frontTrigger){this.frontTrigger.setAttribute("aria-expanded",shouldFlip?"true":"false");this.frontTrigger.setAttribute("aria-pressed",shouldFlip?"true":"false")}if(this.backTrigger){this.backTrigger.setAttribute("aria-expanded",!shouldFlip?"true":"false");this.backTrigger.setAttribute("aria-pressed",!shouldFlip?"true":"false")}this.updateAriaHidden();const cardTitle=this.getCardTitle();const message=shouldFlip?`${cardTitle} card flipped to back side`:`${cardTitle} card flipped to front side`;this.announceToScreenReader(message);if(!this.options.disableAutoFocus){this.manageFocus(shouldFlip)}this.card.dispatchEvent(new CustomEvent("cardFlip",{bubbles:true,detail:{isFlipped:shouldFlip}}))}getCardTitle(){const heading=this.card.querySelector("h2, h3, h4");if(heading)return heading.textContent.trim();if(this.card.hasAttribute("aria-label")){return this.card.getAttribute("aria-label")}return"Flip"}manageFocus(isFlipped){setTimeout((()=>{if(isFlipped){const backFocusable=this.getFirstFocusableElement(this.backSide);if(backFocusable){backFocusable.focus()}else{this.backSide.setAttribute("tabindex","-1");this.backSide.focus()}}else{const frontFocusable=this.getFirstFocusableElement(this.frontSide);if(frontFocusable){frontFocusable.focus()}else{this.frontSide.setAttribute("tabindex","-1");this.frontSide.focus()}}}),100)}getFirstFocusableElement(container){const focusableElements=container.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');return focusableElements.length?focusableElements[0]:null}setInputMethod(method){if(["touch","mouse","keyboard","voice"].includes(method)){this.inputMethod=method;this.card.setAttribute("data-input-method",method)}}setHoverEnabled(enable){this.options.enableHover=enable;this.card.setAttribute("data-disable-hover",!enable)}setupVoiceControl(){if(!("webkitSpeechRecognition"in window)&&!("SpeechRecognition"in window)){console.warn("Universal Flip Card: Web Speech API is not supported in this browser");return}const SpeechRecognition=window.SpeechRecognition||window.webkitSpeechRecognition;this.recognition=new SpeechRecognition;this.recognition.continuous=true;this.recognition.interimResults=false;this.recognition.lang="en-US";this.recognition.onresult=event=>{const result=event.results[event.results.length-1];const transcript=result[0].transcript.trim().toLowerCase();this.processVoiceCommand(transcript)};this.recognition.onerror=event=>{console.warn("Universal Flip Card: Speech recognition error",event.error)};this.recognition.onend=()=>{if(this.options.enableVoiceControl){this.recognition.start()}};try{this.recognition.start();this.setInputMethod("voice");this.addVoiceControlIndicator()}catch(err){console.error("Universal Flip Card: Failed to start speech recognition",err)}}processVoiceCommand(transcript){const hasFlipCommand=this.options.voiceCommands.flip.some((cmd=>transcript.includes(cmd)));const hasFlipBackCommand=this.options.voiceCommands.flipBack.some((cmd=>transcript.includes(cmd)));if(!this.isFlipped&&hasFlipCommand){this.flip(true);this.announceToScreenReader("Card flipped by voice command")}else if(this.isFlipped&&hasFlipBackCommand){this.flip(false);this.announceToScreenReader("Card flipped back by voice command")}}addVoiceControlIndicator(){if(!document.getElementById("voice-control-indicator")){const indicator=document.createElement("div");indicator.id="voice-control-indicator";indicator.style.cssText=`\n        position: fixed;\n        bottom: 20px;\n        right: 20px;\n        background-color: rgba(59, 130, 246, 0.9);\n        color: white;\n        padding: 8px 12px;\n        border-radius: 20px;\n        font-size: 14px;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        z-index: 1000;\n      `;indicator.innerHTML=`\n        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n          <path d="M12 15.5C14.21 15.5 16 13.71 16 11.5V6C16 3.79 14.21 2 12 2C9.79 2 8 3.79 8 6V11.5C8 13.71 9.79 15.5 12 15.5Z" fill="white"/>\n          <path d="M4.03 12.03C3.87 12.03 3.7 12 3.54 11.92C3.15 11.73 2.97 11.3 3.16 10.91C3.5 10.07 4 9.32 4.63 8.69C5.28 8.04 6.05 7.52 6.9 7.13C7.29 6.95 7.72 7.13 7.9 7.52C8.08 7.91 7.91 8.34 7.52 8.52C6.86 8.83 6.24 9.26 5.73 9.77C5.23 10.27 4.81 10.88 4.5 11.54C4.37 11.85 4.2 12.03 4.03 12.03Z" fill="white"/>\n          <path d="M19.97 12.03C19.8 12.03 19.63 11.96 19.5 11.82C19.31 11.67 19.2 11.43 19.2 11.19C19.19 10.94 19.28 10.7 19.45 10.53C19.95 10.03 20.36 9.42 20.65 8.76C20.83 8.37 21.26 8.19 21.65 8.37C22.04 8.55 22.22 8.98 22.04 9.37C21.66 10.22 21.13 10.98 20.48 11.63C20.34 11.77 20.2 11.88 20.02 11.95C20.02 11.96 20 11.96 19.99 11.97C19.98 11.97 19.97 11.97 19.96 11.97C19.96 11.97 19.97 11.97 19.96 11.97C19.96 11.97 19.97 12.03 19.97 12.03Z" fill="white"/>\n          <path d="M12 19.75C9.48 19.75 7.12 18.8 5.36 17.04C4.98 16.66 4.98 16.03 5.36 15.65C5.74 15.27 6.37 15.27 6.75 15.65C10.3 19.2 16.32 18.5 19.05 15.77C19.43 15.39 20.06 15.39 20.44 15.77C20.82 16.15 20.82 16.78 20.44 17.16C18.81 18.79 16.54 19.75 14.12 19.75C13.38 19.75 12.68 19.67 12 19.52" fill="white"/>\n          <path d="M12 22C11.59 22 11.25 21.66 11.25 21.25V19.5C11.25 19.09 11.59 18.75 12 18.75C12.41 18.75 12.75 19.09 12.75 19.5V21.25C12.75 21.66 12.41 22 12 22Z" fill="white"/>\n        </svg>\n        Voice Control Active\n      `;document.body.appendChild(indicator)}}setVoiceControlEnabled(enable){this.options.enableVoiceControl=enable;if(enable&&!this.recognition){this.setupVoiceControl()}else if(!enable&&this.recognition){this.recognition.stop();const indicator=document.getElementById("voice-control-indicator");if(indicator){indicator.remove()}}}static initAll(options={}){const cards=document.querySelectorAll(".universal-card");return Array.from(cards).map((card=>new UniversalFlipCard(card,options)))}}if(typeof window!=="undefined"){window.UniversalFlipCard=UniversalFlipCard;document.addEventListener("DOMContentLoaded",(()=>{window.universalCards=UniversalFlipCard.initAll()}))}