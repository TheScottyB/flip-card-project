function initFlipCards(){const flipCards=document.querySelectorAll(".flip-card");flipCards.forEach(((card,index)=>{const cardId=`flip-card-${index}`;const frontId=`${cardId}-front`;const backId=`${cardId}-back`;const frontSide=card.querySelector(".flip-card-front");const backSide=card.querySelector(".flip-card-back");frontSide.id=frontId;backSide.id=backId;const frontTrigger=frontSide.querySelector(".flip-trigger");const backTrigger=backSide.querySelector(".flip-trigger");if(frontTrigger){frontTrigger.setAttribute("aria-controls",backId);frontTrigger.setAttribute("aria-expanded","false");frontTrigger.setAttribute("aria-pressed","false");frontTrigger.addEventListener("click",(e=>{e.preventDefault();flipCard(card,true)}))}if(backTrigger){backTrigger.setAttribute("aria-controls",frontId);backTrigger.setAttribute("aria-expanded","true");backTrigger.setAttribute("aria-pressed","true");backTrigger.addEventListener("click",(e=>{e.preventDefault();flipCard(card,false)}))}card.setAttribute("tabindex","0");card.addEventListener("keydown",(e=>{if(e.key==="Enter"||e.key===" "){e.preventDefault();const isFlipped=card.classList.contains("flipped");flipCard(card,!isFlipped)}if(e.key==="Escape"&&card.classList.contains("flipped")){e.preventDefault();flipCard(card,false)}}));if(window.matchMedia("(hover: none)").matches){card.addEventListener("click",(e=>{if(!e.target.closest("button, a")){const isFlipped=card.classList.contains("flipped");flipCard(card,!isFlipped)}}))}setupFocusTrap(card,backSide)}))}function flipCard(card,shouldFlip){const cardTitle=card.querySelector("h2")?.textContent.trim()||"Card";if(shouldFlip){card.classList.add("flipped")}else{card.classList.remove("flipped")}const frontTrigger=card.querySelector(".flip-card-front .flip-trigger");const backTrigger=card.querySelector(".flip-card-back .flip-trigger");if(frontTrigger){frontTrigger.setAttribute("aria-expanded",shouldFlip.toString());frontTrigger.setAttribute("aria-pressed",shouldFlip.toString())}if(backTrigger){backTrigger.setAttribute("aria-expanded",(!shouldFlip).toString());backTrigger.setAttribute("aria-pressed",(!shouldFlip).toString())}setTimeout((()=>{if(shouldFlip){const firstFocusable=getFirstFocusableElement(card.querySelector(".flip-card-back"));if(firstFocusable)firstFocusable.focus()}else{const firstFocusable=getFirstFocusableElement(card.querySelector(".flip-card-front"));if(firstFocusable)firstFocusable.focus()}}),100);announceToScreenReader(shouldFlip?`${cardTitle} card flipped to back side`:`${cardTitle} card flipped to front side`)}function getFirstFocusableElement(container){const focusableElements=container.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');return focusableElements.length>0?focusableElements[0]:null}function setupFocusTrap(card,container){container.addEventListener("keydown",(function(e){if(!card.classList.contains("flipped"))return;const focusableElements=container.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');const firstElement=focusableElements[0];const lastElement=focusableElements[focusableElements.length-1];if(e.key==="Tab"){if(e.shiftKey&&document.activeElement===firstElement){e.preventDefault();lastElement.focus()}else if(!e.shiftKey&&document.activeElement===lastElement){e.preventDefault();firstElement.focus()}}}))}function announceToScreenReader(message){let liveRegion=document.getElementById("screen-reader-announcer");if(!liveRegion){liveRegion=document.createElement("div");liveRegion.id="screen-reader-announcer";liveRegion.setAttribute("aria-live","polite");liveRegion.setAttribute("aria-atomic","true");liveRegion.className="sr-only";document.body.appendChild(liveRegion)}liveRegion.textContent=message}document.addEventListener("DOMContentLoaded",initFlipCards);if(window.MutationObserver){const observer=new MutationObserver((mutations=>{mutations.forEach((mutation=>{if(mutation.addedNodes.length){initFlipCards()}}))}));observer.observe(document.body,{childList:true,subtree:true})}